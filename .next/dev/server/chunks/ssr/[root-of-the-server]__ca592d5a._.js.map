{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 28, "column": 0}, "map": {"version":3,"sources":["file:///Users/acanovas/Documents/GitHub/LuchiNobile/components/VideoPlayer.tsx"],"sourcesContent":["'use client'\n\nimport { useEffect, useRef, useState, useCallback } from 'react'\nimport { useRouter } from 'next/navigation'\nimport Player from '@vimeo/player'\nimport Link from 'next/link'\nimport type { Project } from '@/lib/queries'\n\ninterface VideoPlayerProps {\n  project: Project\n}\n\nexport default function VideoPlayer({ project }: VideoPlayerProps) {\n  const router = useRouter()\n  const playerContainerRef = useRef<HTMLDivElement>(null)\n  const playerRef = useRef<Player | null>(null)\n  const isMountedRef = useRef(true)\n  \n  const [isPlaying, setIsPlaying] = useState(true)\n  const [isMuted, setIsMuted] = useState(false)\n  const [progress, setProgress] = useState(0)\n  const [duration, setDuration] = useState(0)\n  const [controlsVisible, setControlsVisible] = useState(true)\n\n  // Initialize Vimeo player\n  useEffect(() => {\n    const container = playerContainerRef.current\n    if (!container) return\n\n    isMountedRef.current = true\n    let rafId: number\n    let player: Player | null = null\n\n    const initPlayer = async () => {\n      try {\n        player = new Player(container, {\n          id: parseInt(project.fullVimeoId, 10),\n          width: window.innerWidth,\n          height: window.innerHeight,\n          autoplay: true,\n          muted: false,\n          loop: false,\n          controls: false,\n          responsive: true,\n        })\n\n        // Wait for player to be ready\n        await player.ready()\n        \n        if (!isMountedRef.current) {\n          player.destroy().catch(() => {})\n          return\n        }\n\n        playerRef.current = player\n\n        player.on('play', () => {\n          if (isMountedRef.current) setIsPlaying(true)\n        })\n        player.on('pause', () => {\n          if (isMountedRef.current) setIsPlaying(false)\n        })\n        player.on('ended', () => {\n          if (isMountedRef.current) setIsPlaying(false)\n        })\n        player.on('volumechange', (data) => {\n          if (isMountedRef.current) setIsMuted(data.volume === 0)\n        })\n\n        const dur = await player.getDuration()\n        if (isMountedRef.current) setDuration(dur)\n        \n        const muted = await player.getMuted()\n        if (isMountedRef.current) setIsMuted(muted)\n\n        // Smooth progress updates using requestAnimationFrame\n        const updateProgress = async () => {\n          if (!isMountedRef.current || !playerRef.current) return\n          \n          try {\n            const currentTime = await playerRef.current.getCurrentTime()\n            const currentDur = await playerRef.current.getDuration()\n            if (isMountedRef.current && currentDur > 0) {\n              setProgress((currentTime / currentDur) * 100)\n            }\n          } catch {\n            // Player was destroyed, stop the loop\n            return\n          }\n          \n          if (isMountedRef.current) {\n            rafId = requestAnimationFrame(updateProgress)\n          }\n        }\n        \n        rafId = requestAnimationFrame(updateProgress)\n      } catch {\n        // Player initialization failed (component unmounted during init)\n      }\n    }\n\n    initPlayer()\n\n    return () => {\n      isMountedRef.current = false\n      cancelAnimationFrame(rafId)\n      if (playerRef.current) {\n        playerRef.current.destroy().catch(() => {})\n        playerRef.current = null\n      } else if (player) {\n        player.destroy().catch(() => {})\n      }\n    }\n  }, [project.fullVimeoId])\n\n  // Hide controls after inactivity\n  useEffect(() => {\n    let timeout: NodeJS.Timeout\n\n    const showControls = () => {\n      setControlsVisible(true)\n      clearTimeout(timeout)\n      timeout = setTimeout(() => setControlsVisible(false), 3000)\n    }\n\n    const handleMouseMove = () => showControls()\n    const handleClick = () => showControls()\n\n    document.addEventListener('mousemove', handleMouseMove)\n    document.addEventListener('click', handleClick)\n\n    showControls()\n\n    return () => {\n      clearTimeout(timeout)\n      document.removeEventListener('mousemove', handleMouseMove)\n      document.removeEventListener('click', handleClick)\n    }\n  }, [])\n\n  const handlePlayPause = useCallback(async () => {\n    const player = playerRef.current\n    if (!player || !isMountedRef.current) return\n\n    try {\n      const paused = await player.getPaused()\n      if (!isMountedRef.current) return\n      \n      if (paused) {\n        await player.play()\n        if (isMountedRef.current) setIsPlaying(true)\n      } else {\n        await player.pause()\n        if (isMountedRef.current) setIsPlaying(false)\n      }\n    } catch {\n      // Player was destroyed, ignore\n    }\n  }, [])\n\n  const handleMuteToggle = useCallback(async () => {\n    const player = playerRef.current\n    if (!player || !isMountedRef.current) return\n\n    try {\n      const muted = await player.getMuted()\n      if (!isMountedRef.current) return\n      \n      await player.setMuted(!muted)\n      if (isMountedRef.current) setIsMuted(!muted)\n    } catch {\n      // Player was destroyed, ignore\n    }\n  }, [])\n\n  const handleProgressClick = useCallback(\n    (e: React.MouseEvent<HTMLDivElement>) => {\n      const player = playerRef.current\n      if (!player || !duration || !isMountedRef.current) return\n\n      const rect = e.currentTarget.getBoundingClientRect()\n      const percent = (e.clientX - rect.left) / rect.width\n      const time = percent * duration\n\n      player.setCurrentTime(time).catch(() => {})\n    },\n    [duration]\n  )\n\n  const handleClose = useCallback(() => {\n    // Set flag to skip splash screen when returning to homepage\n    sessionStorage.setItem('skipSplash', 'true')\n    router.push('/')\n  }, [router])\n\n  return (\n    <div className=\"video-player-page\">\n      <div\n        className={`video-player ${controlsVisible ? 'video-player--controls-visible' : ''}`}\n      >\n        {/* Video Container */}\n        <div ref={playerContainerRef} className=\"video-player__container\" />\n        \n        {/* Clickable overlay for play/pause */}\n        <div \n          className=\"video-player__click-area\"\n          onClick={handlePlayPause}\n          aria-label={isPlaying ? 'Pause video' : 'Play video'}\n        />\n\n        {/* Header */}\n        <div className=\"video-player__header\">\n          <Link \n            href=\"/\" \n            className=\"video-player__logo\"\n            onClick={() => sessionStorage.setItem('skipSplash', 'true')}\n          >\n            Luchi NÃ³bile\n          </Link>\n        </div>\n\n        {/* Controls */}\n        <div className=\"video-player__controls\">\n          <div className=\"video-player__controls-inner\">\n            <div className=\"video-player__controls-inner-left\">\n              {/* Project Info */}\n              <div className=\"video-player__info\">\n                \n                <span className=\"video-player__number\">\n                  {String(project.order || 1).padStart(2, '0')}\n                </span>\n                <div className=\"video-player__info-project\">\n                  <span className=\"video-player__title\">{project.title}</span>\n                  <span className=\"video-player__client\">{project.client}</span>\n                </div>\n              </div>\n\n              {/* Buttons */}\n              <div className=\"video-player__buttons\">\n                <button\n                  className=\"video-player__button\"\n                  onClick={handlePlayPause}\n                >\n                  {isPlaying ? 'Pause' : 'Play'}\n                </button>\n                <button\n                  className=\"video-player__button\"\n                  onClick={handleMuteToggle}\n                >\n                  {isMuted ? 'Unmute' : 'Mute'}\n                </button>\n              </div>\n            </div>\n            {/* Close Button */}\n            <button className=\"video-player__close\" onClick={handleClose}>\n              Close\n            </button>\n          </div>\n        </div>\n\n        {/* Progress Bar */}\n        <div className=\"video-player__progress\">\n              <div\n                className=\"video-player__progress-bar\"\n                onClick={handleProgressClick}\n              >\n                <div\n                  className=\"video-player__progress-fill\"\n                  style={{ width: `${progress}%` }}\n                />\n              </div>\n            </div>\n      </div>\n    </div>\n  )\n}\n\n"],"names":[],"mappings":"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"}}]
}